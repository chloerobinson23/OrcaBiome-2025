### Orcabiome analysis
### PICRUSt analysis
### September 18th, 2025

#######################################
####### QUICK START ###################
#######################################


# Open Ubuntu and navigate to working directory (aligned with PICRUSt location)

cd "/home/cetusecologist/picrust2_inputs"

# Activate PICRUSt

conda activate picrust2

# Run PICRUSt

/home/cetusecologist/miniconda3/envs/picrust2/bin/picrust2_pipeline.py \
  -s /home/cetusecologist/picrust2_inputs/my_sequences_unique_fluke.fasta \
  -i /home/cetusecologist/picrust2_inputs/otu_table_unique.biom \
  -o /home/cetusecologist/picrust2_inputs/picrust2_out \
  -p 1 \
  --verbose


#######################################
### SET UP INSTRUCTIONS ###############
#######################################



# Open Anaconda Prompt

# Enable WSL2 on Windows > Open PowerShell as Admin

wsl --install

# Open WLS terminal (Ubuntu) and set username and password

# Download Miniconda

wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh

# Run the installer & activate conda

bash Miniconda3-latest-Linux-x86_64.sh

# Close and restart Ubuntu

# Test conda

conda --version

# Accept the ToS for the required channels

conda tos accept --override-channels --channel https://repo.anaconda.com/pkgs/main
conda tos accept --override-channels --channel https://repo.anaconda.com/pkgs/r

# Install & activate PICRUSt2

conda create -n picrust2 -c bioconda -c conda-forge picrust2 -y
conda activate picrust2

# Install pandas in your current environment

conda install pandas -y

# Prepare your files (otu_table.csv and my_sequences.csv) in one working folder and navigate to folder

cd "/mnt/c/Users/ChloeRobinson/OneDrive - Ocean Wise Conservation Association/OWCA/Ocean Wise/Research Projects/eDNA/OrcaBiome/OrcaBiome_analysis/picrust2"

# Convert rep_seqs.csv → FASTA (in R - see R PICRUSt script)

# Convert otu_table.csv → BIOM

python - <<'PY'
import pandas as pd
pd.read_csv('otu_fluke_unique.csv', index_col=0).to_csv('otu_table_unique.tsv', sep='\t')
PY

biom convert -i otu_table_unique.tsv -o otu_table_unique.biom --to-hdf5 --table-type="OTU table"

biom summarize-table -i otu_table.biom -o otu_table_summary.txt


# Create file .wslconfig and adjust WSL2 memory and CPU allocation to below (to reduce risk of code termination)

[wsl2]
memory=16GB
processors=4
swap=8GB
localhostForwarding=true


# Save file and type wsl --shutdown in PowerShell. Re-open Ubuntu.


# Ensure you are running code where PICRUSt is - suggest to make a new directory and move files there

mkdir -p /home/cetusecologist/picrust2_inputs

cp "/mnt/c/Users/ChloeRobinson/OneDrive - Ocean Wise Conservation Association/OWCA/Ocean Wise/Research 

Projects/eDNA/OrcaBiome/OrcaBiome_analysis/picrust2/my_sequences_unique_fluke.fasta" /home/cetusecologist/picrust2_inputs/
cp "/mnt/c/Users/ChloeRobinson/OneDrive - Ocean Wise Conservation Association/OWCA/Ocean Wise/Research Projects/eDNA/OrcaBiome/OrcaBiome_analysis/picrust2/otu_table_unique.biom" /home/cetusecologist/picrust2_inputs/


#FINALLY run PICRUSt deadline

/home/cetusecologist/miniconda3/envs/picrust2/bin/picrust2_pipeline.py \
  -s /home/cetusecologist/picrust2_inputs/my_sequences_unique_fluke.fasta \
  -i /home/cetusecologist/picrust2_inputs/otu_table_unique.biom \
  -o /home/cetusecologist/picrust2_inputs/picrust2_out \
  -p 1 \
  --verbose

















